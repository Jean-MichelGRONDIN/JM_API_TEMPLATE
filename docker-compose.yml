version: '3.3'

services:
    typescript:
        tty: true
        image: node:14.17.0
        env_file:
            - .env
        volumes: 
            - ./:/home/node
        working_dir: /home/node 
        expose:
            - "${API_PORT}"
        ports:
            - "${API_PORT}:${API_PORT}"
        depends_on:
            - database
        links:
            - database
        command: bash -c "npm i && npm run serve"
        network_mode: bridge
        restart: "always"

    database:
        image: "postgres:13"
        expose:
          - "${POSTGRES_PORT}"
        ports:
          - "${POSTGRES_PORT}:${POSTGRES_PORT}"
        environment:
          TZ: ${API_TZ}
          LC_ALL: C.UTF-8
          POSTGRES_USER: ${POSTGRES_USER}
          POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
          POSTGRES_DB: ${POSTGRES_DB}
        volumes:
          - data:/var/lib/postgresql/data
        env_file:
          - .env
        command: -p ${POSTGRES_PORT}
        network_mode: bridge
        restart: "always"
volumes:
    data:
    
